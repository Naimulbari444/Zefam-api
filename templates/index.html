<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Bot Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #121212; color: #ffffff; font-family: 'Segoe UI', Arial, sans-serif; padding: 15px; }
        .container-box { max-width: 450px; margin: auto; background: #1e1e1e; padding: 25px; border-radius: 12px; border: 1px solid #333; }
        h4 { color: #00ff88; text-align: center; margin-bottom: 20px; font-weight: bold; }
        
        .status-bar { background: #2a2a2a; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 15px; font-size: 14px; border: 1px solid #444; }
        
        label { font-size: 12px; color: #bbb; margin-bottom: 5px; display: block; font-weight: bold; }
        .form-control, .form-select { 
            background: #2a2a2a !important; border: 1px solid #444 !important; 
            color: #fff !important; font-size: 15px; height: 45px; border-radius: 8px; margin-bottom: 15px; 
        }
        .form-control::placeholder { color: #777 !important; }

        .btn-start { background: #00ff88; color: #000; font-weight: bold; width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 16px; }
        .btn-stop { background: #cc3333; color: #fff; font-weight: bold; width: 100%; padding: 10px; border: none; border-radius: 8px; margin-top: 10px; font-size: 14px; }

        .log-container { 
            background: #000; color: #00ff88; height: 250px; overflow-y: auto; 
            border: 1px solid #333; padding: 12px; font-family: monospace; 
            font-size: 12px; border-radius: 8px; margin-top: 20px; line-height: 1.5;
        }
        .log-line { border-bottom: 1px solid #111; padding-bottom: 2px; }
    </style>
</head>
<body>

<div class="container-box">
    <h4>SMART MULTI-BOT</h4>
    <div class="status-bar">Running Tasks: <span id="count" style="color:#00ff88; font-weight:bold;">0</span></div>

    <form id="botAction">
        <label>SELECT SERVICE</label>
        <select id="sid" class="form-select">
            {% for s in services %}
            <option value="{{ s.id }}" {% if not s.is_ok %}disabled style="color:#ff5555;"{% endif %}>
                {{ s.name }} [{{ s.status }}]
            </option>
            {% endfor %}
        </select>

        <label>VIDEO LINK</label>
        <input type="url" id="link" class="form-control" 
               placeholder="Example: https://vt.tiktok.com/ZSXXXX/" required>

        <label>TARGET AMOUNT</label>
        <input type="number" id="trgt" class="form-control" placeholder="Example: 1000">

        <button type="submit" class="btn-start" id="startBtn">START SERVICE</button>
    </form>
    
    <button onclick="stopAll()" class="btn-stop">STOP ALL TASKS</button>

    <div id="logs" class="log-container">> System ready.</div>
</div>

<script>
    async function updateUI() {
        try {
            const res = await fetch('/get_logs');
            const data = await res.json();
            document.getElementById('logs').innerHTML = data.logs.map(l => `<div class="log-line">${l}</div>`).join('');
            document.getElementById('logs').scrollTop = document.getElementById('logs').scrollHeight;
            document.getElementById('count').innerText = data.running_count;
        } catch(e) {}
    }

    document.getElementById('botAction').onsubmit = async (e) => {
        e.preventDefault();
        const startBtn = document.getElementById('startBtn');
        startBtn.disabled = true;
        startBtn.innerText = "Processing...";

        const sel = document.getElementById('sid');
        const fd = new FormData();
        fd.append('service_id', sel.value);
        fd.append('service_name', sel.options[sel.selectedIndex].text.split(' [')[0]);
        fd.append('video_link', document.getElementById('link').value);
        fd.append('target', document.getElementById('trgt').value);
        
        await fetch('/start', { method: 'POST', body: fd });
        
        setTimeout(() => {
            startBtn.disabled = false;
            startBtn.innerText = "START SERVICE";
        }, 2000);
    };

    async function stopAll() {
        if(confirm("Stop all tasks?")) await fetch('/stop_all', { method: 'POST' });
    }

    setInterval(updateUI, 3000);
</script>
</body>
</html>
